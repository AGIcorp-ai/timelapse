<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Meta-Analysis Verdict</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .verdict-header {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 18px;
      }
      .badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 0.88rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .badge.diverging { background: #fde8e8; color: #b91c1c; border: 1px solid #fca5a5; }
      .badge.converging { background: #d1fae5; color: #065f46; border: 1px solid #6ee7b7; }
      .badge.stalled { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
      .confidence-bar {
        width: 120px;
        height: 10px;
        background: var(--line);
        border-radius: 6px;
        overflow: hidden;
      }
      .confidence-fill {
        height: 100%;
        border-radius: 6px;
        background: var(--accent);
      }
      .action-list { list-style: none; padding: 0; margin: 0; counter-reset: action; }
      .action-item {
        counter-increment: action;
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        background: #fff;
      }
      .action-item::before {
        content: "#" counter(action);
        font-family: "IBM Plex Mono", monospace;
        font-weight: 700;
        color: var(--accent-2);
        font-size: 0.82rem;
      }
      .action-item h3 { margin: 6px 0 8px; font-size: 1rem; }
      .action-item p { margin: 0 0 6px; color: var(--muted); font-size: 0.92rem; }
      .effort-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 700;
        text-transform: uppercase;
      }
      .effort-low { background: #d1fae5; color: #065f46; }
      .effort-medium { background: #fef3c7; color: #92400e; }
      .effort-high { background: #fde8e8; color: #b91c1c; }
      .repo-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 500;
        background: #e0e7ff;
        color: #3730a3;
        margin-left: 6px;
      }
      .debt-list, .risk-list { list-style: none; padding: 0; margin: 0; }
      .debt-item, .risk-item {
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        background: #fff;
      }
      .debt-item h3, .risk-item h3 { margin: 0 0 6px; font-size: 0.95rem; }
      .debt-item p, .risk-item p { margin: 0 0 4px; color: var(--muted); font-size: 0.9rem; }
      .likelihood-tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 700;
        text-transform: uppercase;
      }
      .likelihood-low { background: #d1fae5; color: #065f46; }
      .likelihood-medium { background: #fef3c7; color: #92400e; }
      .likelihood-high { background: #fde8e8; color: #b91c1c; }
      .back-link {
        display: inline-block;
        margin-bottom: 16px;
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
      }
      .back-link:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <main>
      <section class="panel" style="margin-top: 32px;">
        <a class="back-link" href="index.html">&larr; Back to Dashboard</a>
        <h1>Meta-Analysis Verdict</h1>
        <p style="color: var(--muted);">GPT-5.2 senior-engineer review of project engineering output.</p>

        <div id="verdict-container">
          <p style="color: var(--muted);">Loading verdict data...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>
        Built for legible engineering analytics. Source:
        <a href="https://github.com/AGIcorp-ai/timelapse">AGIcorp-ai/timelapse</a>
      </p>
    </footer>

    <script>
    (function () {
      fetch("meta_verdict.json")
        .then(function (r) { return r.json(); })
        .then(render)
        .catch(function (err) {
          document.getElementById("verdict-container").innerHTML =
            "<p>Failed to load verdict: " + err.message + "</p>";
        });

      function esc(s) {
        var d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }

      function render(data) {
        var v = data.verdict || {};
        var actions = data.priority_actions || [];
        var techDebt = data.tech_debt || [];
        var risks = data.risks || [];
        var trigger = data.next_review_trigger || "";

        var trajectory = v.trajectory || "unknown";
        var conf = (v.confidence || 0);
        var confPct = Math.round(conf * 100);

        var html = "";

        // Verdict header
        html += '<div class="verdict-header">';
        html += '<span class="badge ' + esc(trajectory) + '">' + esc(trajectory) + '</span>';
        html += '<span style="font-size:0.88rem;color:var(--muted);">Confidence: ' + confPct + '%</span>';
        html += '<div class="confidence-bar"><div class="confidence-fill" style="width:' + confPct + '%;"></div></div>';
        html += '</div>';

        // Primary risk
        html += '<h2>Primary Risk</h2>';
        html += '<p>' + esc(v.primary_risk || "") + '</p>';

        // Highest leverage
        html += '<h2>Highest-Leverage Action</h2>';
        html += '<p style="font-weight:500;">' + esc(v.highest_leverage_action || "") + '</p>';

        // Priority actions
        html += '<h2>Priority Actions</h2>';
        html += '<ol class="action-list">';
        actions.forEach(function (a) {
          var effort = (a.effort || "medium").toLowerCase();
          html += '<li class="action-item">';
          html += '<h3>' + esc(a.action || "") + '</h3>';
          html += '<p>' + esc(a.rationale || "") + '</p>';
          html += '<span class="effort-tag effort-' + effort + '">' + esc(a.effort || "") + '</span>';
          if (a.repo) {
            html += '<span class="repo-tag">' + esc(a.repo) + '</span>';
          }
          html += '</li>';
        });
        html += '</ol>';

        // Tech debt
        html += '<h2>Technical Debt</h2>';
        html += '<ul class="debt-list">';
        techDebt.forEach(function (d) {
          html += '<li class="debt-item">';
          html += '<h3>' + esc(d.location || "") + '</h3>';
          html += '<p><strong>Issue:</strong> ' + esc(d.issue || "") + '</p>';
          html += '<p><strong>Fix:</strong> ' + esc(d.fix || "") + '</p>';
          html += '</li>';
        });
        html += '</ul>';

        // Risks
        html += '<h2>Risk Register</h2>';
        html += '<ul class="risk-list">';
        risks.forEach(function (r) {
          var lk = (r.likelihood || "medium").toLowerCase();
          html += '<li class="risk-item">';
          html += '<h3>' + esc(r.risk || "") + '</h3>';
          html += '<span class="likelihood-tag likelihood-' + lk + '">' + esc(r.likelihood || "") + '</span>';
          html += '<p style="margin-top:8px;"><strong>Mitigation:</strong> ' + esc(r.mitigation || "") + '</p>';
          html += '</li>';
        });
        html += '</ul>';

        // Next review trigger
        html += '<h2>Next Review Trigger</h2>';
        html += '<p>' + esc(trigger) + '</p>';

        document.getElementById("verdict-container").innerHTML = html;
      }
    })();
    </script>
  </body>
</html>
